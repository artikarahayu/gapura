<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>GAPURA EMAS - Kabupaten Pasuruan</title>
    <link rel="stylesheet" href="css/global.css" />
    <link rel="stylesheet" href="css/beranda.css" />
    <link rel="stylesheet" href="css/fab.css" />
    <script src="js/accessibility.js" defer></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
    />
  </head>

  <body>
    <header class="navbar">
      <div class="logo">
        <img
          src="assets/gapura.png"
          alt="Logo Gapura Emas"
          class="logo-image"
        />
        <h1>GAPURA<span class="orange">EMAS</span></h1>
      </div>
      <nav>
        <a href="index.html" class="active">Beranda</a>
        <span class="nav-separator">|</span>
        <a href="personalisasi.html">Personalisasi</a>
        <span class="nav-separator">|</span>
        <a href="keamanan.html">Keamanan</a>
        <span class="nav-separator">|</span>
        <a href="riwayat.html">Riwayat</a>
      </nav>
      <div class="user-info">
        <i class="fas fa-bell notification-icon"></i>
        <div class="user-details">
          <span>Nama Pengguna</span>
          <p class="role">Role Pengguna</p>
        </div>
        <i class="fas fa-user-circle user-icon" id="user-icon-btn"></i>
        <div class="profile-dropdown" id="profile-dropdown">
          <div class="profile-dropdown-header">
            <button class="profile-close-btn" id="profile-close-btn">
              &times;
            </button>
          </div>
          <div class="profile-dropdown-body">
            <a href="#" class="btn btn-danger">
              <i class="fas fa-sign-out-alt"></i>
              <span>Logout</span>
            </a>
          </div>
        </div>
      </div>
    </header>

    <div class="notification-panel" id="notification-panel">
      <div class="notification-header">
        <h2>Notifikasi</h2>
        <button class="notification-close-btn" id="notification-close-btn">
          &times;
        </button>
      </div>
      <div class="notification-list">
        <a href="#" class="notification-item unread">
          <span class="notification-dot"></span>
          <p class="notification-text">Akun anda terblokir</p>
        </a>
        <a href="#" class="notification-item unread">
          <span class="notification-dot"></span>
          <p class="notification-text">
            Anda mendapatkan izin akses masuk Sepakat Kabupaten Pasuruan
          </p>
        </a>
      </div>
      <div class="notification-footer">
        <button class="btn btn-secondary" id="clear-notifications">
          Bersihkan semua notifikasi
        </button>
      </div>
    </div>

    <main>
      <section class="hero">
        <div class="container hero-container">
          <div class="hero-text">
            <p>Satu Akses Untuk Semua Layanan Digital Kabupaten Pasuruan.</p>
          </div>
          <div class="hero-image">
            <div class="orange-circle"></div>
            <img
              src="https://upload.wikimedia.org/wikipedia/commons/9/9a/Lambang_Kabupaten_Pasuruan.png"
              alt="Lambang Kabupaten Pasuruan"
              class="logo-pasuruan"
            />
          </div>
        </div>
      </section>

      <section class="banner-section">
        <div class="banner">
          <img src="assets/banner.jpg" alt="Banner 1" />
        </div>
        <div class="banner">
          <img src="assets/banner.jpg" alt="Banner 2" />
        </div>
        <div class="banner">
          <img src="assets/banner.jpg" alt="Banner 3" />
        </div>
      </section>

      <section class="app-section container">
        <div class="app-navigation">
          <div class="app-tabs">
            <button class="tab-link active">Semua Aplikasi</button>
            <button class="tab-link">Terbaru</button>
          </div>
          <div class="search-bar">
            <input type="text" placeholder="Cari Aplikasi" />
            <i class="fas fa-search search-icon"></i>
          </div>
        </div>

        <div class="app-grid">
          <div class="app-card">
            <div class="card-main">
              <img
                src="assets/smart.png"
                alt="App Icon"
                class="app-logo-placeholder"
              />
              <div class="app-info">
                <h3>SMART Perizinan</h3>
                <p>Sistem Manajemen Administrasi Perizinan Terpadu</p>
              </div>
            </div>
            <a
              href="https://smartperizinan.pasuruankab.go.id/admin"
              target="_blank"
              class="app-status status-soon"
              >Segera Hadir</a
            >
          </div>
          <div class="app-card">
            <div class="card-main">
              <img
                src="assets/sepakat.png"
                alt="App Icon"
                class="app-logo-placeholder"
              />
              <div class="app-info">
                <h3>Sepakat</h3>
                <p>
                  Sistem Pengaduan dan Konsultasi Inspektorat Daerah Kabupaten
                  Pasuruan Berintegritas
                </p>
              </div>
            </div>
            <a
              href="https://sepakat.pasuruankab.go.id/admin"
              target="_blank"
              class="app-status status-open"
              >Buka</a
            >
          </div>
          <div class="app-card">
            <div class="card-main">
              <img
                src="assets/sakti.png"
                alt="App Icon"
                class="app-logo-placeholder"
              />
              <div class="app-info">
                <h3>SAKTI</h3>
                <p>Sistem Aplikasi Konsultasi Teknologi Informatika</p>
              </div>
            </div>
            <a
              href="https://sakti.pasuruankab.go.id/beranda"
              target="_blank"
              class="app-status status-open"
              >Buka</a
            >
          </div>
          <div class="app-card">
            <div class="card-main">
              <img
                src="assets/apik.png"
                alt="App Icon"
                class="app-logo-placeholder"
              />
              <div class="app-info">
                <h3>APIK</h3>
                <p>
                  sistem informasi pendataan UMKM (Aplikasi Pemberdayaan dan
                  Peningkatan Kapasitas UMKM)
                </p>
              </div>
            </div>
            <a
              href="https://apik.pasuruankab.go.id"
              target="_blank"
              class="app-status status-soon"
              >Segera Hadir</a
            >
          </div>
          <div class="app-card">
            <div class="card-main">
              <img
                src="assets/hallo.png"
                alt="App Icon"
                class="app-logo-placeholder"
              />
              <div class="app-info">
                <h3>Hallo Fish</h3>
                <p>Pelayanan Konsultasi, Informasi dan Edukasi Perikanan</p>
              </div>
            </div>
            <a
              href="https://hallofish.pasuruankab.go.id"
              target="_blank"
              class="app-status status-soon"
              >Segera Hadir</a
            >
          </div>
          <div class="app-card">
            <div class="card-main">
              <img
                src="assets/saraswati.png"
                alt="App Icon"
                class="app-logo-placeholder"
              />
              <div class="app-info">
                <h3>Saraswati</h3>
                <p>
                  Solusi terintegrasi untuk pengelolaan & peminjaman fasilitas
                  kantor, ruangan, kendaraan, dan aset daerah lainnya.
                </p>
              </div>
            </div>
            <a
              href="https://saraswati.pasuruankab.go.id"
              target="_blank"
              class="app-status status-soon"
              >Segera Hadir</a
            >
          </div>
          <div class="app-card">
            <div class="card-main">
              <img
                src="assets/spbe.png"
                alt="App Icon"
                class="app-logo-placeholder"
              />
              <div class="app-info">
                <h3>SPBE</h3>
                <p>
                  Sistem Pemerintahan Berbasis Elektronik (SPBE) Mendukung
                  Pelayanan Publik
                </p>
              </div>
            </div>
            <a
              href="https://spbe.pasuruankab.go.id"
              target="_blank"
              class="app-status status-open"
              >Buka</a
            >
          </div>
          <div class="app-card">
            <div class="card-main">
              <img
                src="assets/sikap.png"
                alt="App Icon"
                class="app-logo-placeholder"
              />
              <div class="app-info">
                <h3>Sikap Baja</h3>
                <p>
                  Aplikasi untuk mengelola setiap tahap pengadaan dengan cara
                  yang lebih terstruktur dan praktis
                </p>
              </div>
            </div>
            <a
              href="https://sikapbaja.pasuruankab.go.id"
              target="_blank"
              class="app-status status-soon"
              >Segera Hadir</a
            >
          </div>
          <div class="app-card">
            <div class="card-main">
              <img
                src="assets/sapa.png"
                alt="App Icon"
                class="app-logo-placeholder"
              />
              <div class="app-info">
                <h3>Sapa Warga</h3>
                <p>Sistem Administrasi dan Pelayanan Aktif untuk Warga</p>
              </div>
            </div>
            <a
              href="https://sapawarga.pasuruankab.go.id"
              target="_blank"
              class="app-status status-soon"
              >Segera Hadir</a
            >
          </div>
          <div class="app-card">
            <div class="card-main">
              <img
                src="assets/majestik.png"
                alt="App Icon"
                class="app-logo-placeholder"
              />
              <div class="app-info">
                <h3>Majestik</h3>
                <p>Sistem terintegrasi untuk pengelolaan aset TIK</p>
              </div>
            </div>
            <a
              href="https://majestik.pasuruankab.go.id"
              target="_blank"
              class="app-status status-soon"
              >Segera Hadir</a
            >
          </div>
          <div class="app-card">
            <div class="card-main">
              <img
                src="assets/butam.png"
                alt="App Icon"
                class="app-logo-placeholder"
              />
              <div class="app-info">
                <h3>Buku Tamu</h3>
                <p>
                  Digitalisasi pencatatan kunjungan dan pengukuran kepuasan
                  masyarakat berbasis AI dan PEKPPP
                </p>
              </div>
            </div>
            <a
              href="https://bukutamu.pasuruankab.go.id"
              target="_blank"
              class="app-status status-soon"
              >Segera Hadir</a
            >
          </div>
          <div class="app-card">
            <div class="card-main">
              <img
                src="assets/anjab.png"
                alt="App Icon"
                class="app-logo-placeholder"
              />
              <div class="app-info">
                <h3>Anjab (Development)</h3>
                <p>Deskripsi Aplikasi</p>
              </div>
            </div>
            <a href="#" class="app-status status-soon">Segera Hadir</a>
          </div>
        </div>
      </section>
    </main>

    <div id="popup-overlay" class="popup-overlay">
      <div class="popup-modal">
        <div class="popup-icon-wrapper">
          <i class="fas fa-exclamation-triangle"></i>
        </div>
        <div class="popup-content">
          <h3 class="popup-title"><strong>Pemberitahuan Penting!!</strong></h3>
          <div class="popup-body">
            <p>
              Sehubungan dengan adanya perubahan mekanisme pada perusahaan yang
              menaungi WhatsApp API Business, bersama ini disampaikan bahwa
              fitur notifikasi WhatsApp pada beberapa aplikasi mulai tanggal
              <b>7 Agustus 2025 DIHENTIKAN</b>.
            </p>
            <p>
              Selanjutnya, fitur notifikasi tersebut akan dialihkan ke
              <b>Aplikasi TELEGRAM</b>.
            </p>
          </div>
        </div>
        <div class="popup-footer">
          <button class="btn-primary-popup" id="popup-understand-btn">
            Saya Mengerti
          </button>
        </div>
      </div>
    </div>

    <div id="app-popup-overlay" class="app-popup-overlay">
      <div class="app-popup-modal">
        <button class="app-popup-close-btn" id="app-popup-close-btn">
          &times;
        </button>
        <div class="app-popup-icon-wrapper">
          <img id="app-popup-icon" src="" alt="App Icon" />
        </div>
        <div class="app-popup-content">
          <h3 id="app-popup-title">Nama Aplikasi</h3>
          <div class="app-popup-body">
            <p id="app-popup-description">Deskripsi aplikasi lengkap.</p>
          </div>
        </div>
        <div class="app-popup-footer">
          <button class="app-popup-action-btn" id="app-popup-action-btn">
            Buka
          </button>
        </div>
      </div>
    </div>

    <div class="fab-container">
      <button
        class="fab"
        aria-haspopup="true"
        aria-expanded="false"
        aria-label="Aksesibilitas"
      >
        <i class="fas fa-universal-access"></i>
      </button>
    </div>

    <footer>
      <div class="container footer-content">
        <p class="copyright">
          COPYRIGHT © 2022–2025 Diskominfo Kabupaten Pasuruan
        </p>
        <p class="gov-text">Pemerintah Daerah Kabupaten Pasuruan</p>
      </div>
    </footer>

    <nav class="mobile-nav">
      <a href="index.html" class="active">
        <i class="fas fa-home"></i>
        <span>Beranda</span>
      </a>
      <a href="personalisasi.html">
        <i class="fas fa-user-cog"></i>
        <span>Personalisasi</span>
      </a>
      <a href="keamanan.html">
        <i class="fas fa-shield-alt"></i>
        <span>Keamanan</span>
      </a>
      <a href="riwayat.html">
        <i class="fas fa-history"></i>
        <span>Riwayat</span>
      </a>
    </nav>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        // ====== FUNGSI HELPER LAST ACCESS ======
        const padZero = (num) => (num < 10 ? "0" + num : num);
        const formatDateForDisplay = (dateObj) => {
          const day = padZero(dateObj.getDate());
          const month = padZero(dateObj.getMonth() + 1);
          const year = dateObj.getFullYear();
          const hours = padZero(dateObj.getHours());
          const minutes = padZero(dateObj.getMinutes());
          return `<b>Akses</b>: ${day}-${month}-${year} ${hours}:${minutes}`;
        };

        const updateAccessTimeUI = (card, dateObj) => {
          const el = card?.querySelector(".last-access-text");
          if (el) el.innerHTML = formatDateForDisplay(dateObj);
        };

        const saveAccessTime = (appName, card) => {
          if (!appName) return;
          try {
            const accessTimes =
              JSON.parse(localStorage.getItem("appAccessTimes")) || {};
            const now = new Date();
            accessTimes[appName] = now.toISOString();
            localStorage.setItem("appAccessTimes", JSON.stringify(accessTimes));
            updateAccessTimeUI(card, now);
          } catch (err) {
            console.error("Gagal menyimpan waktu akses:", err);
          }
        };

        // ====== BAGIAN 1: TAB FILTER ======
        const tabLinks = document.querySelectorAll(".tab-link");
        const appCards = document.querySelectorAll(".app-card");
        if (tabLinks.length && appCards.length) {
          tabLinks.forEach((tab) => {
            tab.addEventListener("click", function () {
              tabLinks.forEach((t) => t.classList.remove("active"));
              this.classList.add("active");

              const tabText = this.textContent.trim();
              appCards.forEach((card) => {
                const status = card.querySelector(".app-status");
                const isOpen = status?.classList.contains("status-open");
                card.style.display =
                  tabText === "Semua Aplikasi" ||
                  (tabText === "Terbaru" && isOpen)
                    ? "flex"
                    : "none";
              });
            });
          });
        }

        // ====== BAGIAN 2: DROPDOWN NOTIFIKASI & PROFIL ======
        const notifIcon = document.querySelector(".notification-icon");
        const notifPanel = document.getElementById("notification-panel");
        const notifCloseBtn = document.getElementById("notification-close-btn");
        const userIconBtn = document.getElementById("user-icon-btn");
        const profileDropdown = document.getElementById("profile-dropdown");
        const profileCloseBtn = document.getElementById("profile-close-btn");

        if (
          notifIcon &&
          notifPanel &&
          notifCloseBtn &&
          userIconBtn &&
          profileDropdown &&
          profileCloseBtn
        ) {
          notifIcon.addEventListener("click", (e) => {
            e.stopPropagation();
            notifPanel.classList.toggle("active");
            profileDropdown.classList.remove("active");
          });

          notifCloseBtn.addEventListener("click", () =>
            notifPanel.classList.remove("active")
          );
          userIconBtn.addEventListener("click", (e) => {
            e.stopPropagation();
            profileDropdown.classList.toggle("active");
            notifPanel.classList.remove("active");
          });

          profileCloseBtn.addEventListener("click", () =>
            profileDropdown.classList.remove("active")
          );

          document.addEventListener("click", (e) => {
            if (!notifPanel.contains(e.target) && !notifIcon.contains(e.target))
              notifPanel.classList.remove("active");
            if (
              !profileDropdown.contains(e.target) &&
              !userIconBtn.contains(e.target)
            )
              profileDropdown.classList.remove("active");
          });
        }

        // ====== BAGIAN 3: POPUP PEMBERITAHUAN ======
        const popupOverlay = document.getElementById("popup-overlay");
        const closeBtnUnderstand = document.getElementById(
          "popup-understand-btn"
        );

        if (popupOverlay && closeBtnUnderstand) {
          const closePopup = () => popupOverlay.classList.remove("active");
          if (!sessionStorage.getItem("popupShown")) {
            setTimeout(() => {
              popupOverlay.classList.add("active");
              sessionStorage.setItem("popupShown", "true");
            }, 1000);
          }
          closeBtnUnderstand.addEventListener("click", closePopup);
          popupOverlay.addEventListener("click", (e) => {
            if (e.target === popupOverlay) closePopup();
          });
        }

        // ====== BAGIAN 4: LAST ACCESS DISPLAY ======
        try {
          const accessTimes =
            JSON.parse(localStorage.getItem("appAccessTimes")) || {};
          const allAppCards = document.querySelectorAll(".app-card");
          let modified = false;

          allAppCards.forEach((card) => {
            const appNameEl = card.querySelector(".app-info h3");
            const statusEl = card.querySelector(".app-status");
            if (!appNameEl || !statusEl) return;

            const appName = appNameEl.textContent.trim();
            const footer = document.createElement("div");
            footer.className = "app-card-footer";

            const lastAccess = document.createElement("p");
            lastAccess.className = "last-access-text";

            if (statusEl.classList.contains("status-open")) {
              const saved = accessTimes[appName];
              lastAccess.innerHTML = saved
                ? formatDateForDisplay(new Date(saved))
                : "<i>Belum pernah dibuka</i>";
            } else {
              lastAccess.innerHTML = "<i>Belum pernah dibuka</i>";
              if (accessTimes[appName]) {
                delete accessTimes[appName];
                modified = true;
              }
            }

            footer.append(lastAccess, statusEl);
            card.appendChild(footer);
          });

          if (modified)
            localStorage.setItem("appAccessTimes", JSON.stringify(accessTimes));
        } catch (err) {
          console.error("Gagal menampilkan Last Access:", err);
        }

        // ====== BAGIAN 5: POPUP APP DETAIL (MOBILE) ======
        const appPopupOverlay = document.getElementById("app-popup-overlay");
        const appPopupCloseBtn = document.getElementById("app-popup-close-btn");
        const appPopupIcon = document.getElementById("app-popup-icon");
        const appPopupTitle = document.getElementById("app-popup-title");
        const appPopupDescription = document.getElementById(
          "app-popup-description"
        );
        const appPopupActionBtn = document.getElementById(
          "app-popup-action-btn"
        );

        let currentAppHref = "#";
        let currentAppName = "";
        let currentCard = null;

        const openAppPopup = (card) => {
          const iconSrc =
            card.querySelector(".app-logo-placeholder")?.src || "";
          const title = card.querySelector(".app-info h3")?.textContent || "";
          const desc = card.querySelector(".app-info p")?.textContent || "";
          const statusEl = card.querySelector(".app-status");
          if (!statusEl) return;

          const isOpen = statusEl.classList.contains("status-open");
          currentAppHref = statusEl.href || "#";
          currentAppName = title.trim();
          currentCard = card;

          appPopupIcon.src = iconSrc;
          appPopupTitle.textContent = title;
          appPopupDescription.textContent = desc;
          appPopupActionBtn.textContent = isOpen ? "Buka" : "Segera Hadir";
          appPopupActionBtn.disabled = !isOpen;
          appPopupActionBtn.classList.toggle("disabled", !isOpen);
          appPopupOverlay.classList.add("active");
        };

        const closeAppPopup = () => {
          appPopupOverlay?.classList.remove("active");
          currentCard = null;
        };

        document.querySelectorAll(".app-card").forEach((card) => {
          card.addEventListener("click", (e) => {
            if (window.innerWidth < 768) {
              e.preventDefault();
              openAppPopup(card);
            }
          });
        });

        appPopupCloseBtn?.addEventListener("click", closeAppPopup);
        appPopupOverlay?.addEventListener("click", (e) => {
          if (e.target === appPopupOverlay) closeAppPopup();
        });
        appPopupActionBtn?.addEventListener("click", function () {
          if (!this.disabled && currentCard) {
            saveAccessTime(currentAppName, currentCard);
            if (currentAppHref && currentAppHref !== "#")
              window.open(currentAppHref, "_blank");
            closeAppPopup();
          }
        });

        // ====== BAGIAN 6: LAST ACCESS (DESKTOP) ======
        document.querySelectorAll(".app-status.status-open").forEach((btn) => {
          btn.addEventListener("click", function () {
            if (window.innerWidth >= 768) {
              const card = this.closest(".app-card");
              const appName = card
                ?.querySelector(".app-info h3")
                ?.textContent?.trim();
              if (appName) saveAccessTime(appName, card);
            }
          });
        });

        // ====== BAGIAN 7: HAPUS NOTIFIKASI ======
        const clearBtn = document.getElementById("clear-notifications");
        const notifList = document.querySelector(".notification-list");

        if (clearBtn && notifList && notifPanel) {
          clearBtn.addEventListener("click", function () {
            notifList.innerHTML = "";
            const empty = document.createElement("p");
            empty.style.padding = "15px 20px";
            empty.style.textAlign = "center";
            empty.style.color = "#777";
            empty.textContent = "Tidak ada notifikasi baru.";
            notifList.appendChild(empty);

            this.textContent = "Bersih";
            this.disabled = true;

            setTimeout(() => notifPanel.classList.remove("active"), 1000);
          });
        }
      });
    </script>
  </body>
</html>
